<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="assets/css/pages/modal-contrate/index.css">

</head>

<body>
    <div class="modal-overlay">
        <section class="modal-overlay__section-tela-contrate">
            <h2>Escolher data</h2>
            <form id="form-contrate" action="#">
                <div class="section-tela-contrate__div-wrapper">
                    <div class="div-wrapper__next-left">
                        <div class="next-left__icon">❮</div>
                    </div>
                    <section class="div-wrapper__dias-disponiveis"></section>
                    <input id="input-data-selecionada" name="data" type="hidden">
                    <div class="div-wrapper__next-rigth">
                        <div class="next-rigth__icon">❯</div>
                    </div>
                </div>
                <p>Setembro 2025</p>
                <hr>
                <div class="section-tela-contrate__container-horario">
                    <div class="container-horario__manha">
                        <p>Manhã</p>
                    </div>
                    <div class="container-horario__tarde">
                        <p>Tarde</p>
                    </div>
                    <div class="container-horario__noite">
                        <p>Noite</p>
                    </div>
                </div>
                <div class="section-tela-contrate__horarios">
                    <div class="horarios__next-left">
                        <div class="next-left__icon">❮</div>
                    </div>
                    <div class="horarios__wrapper">
                        <div class="wrapper__horario">
                        </div>
                    </div>
                    <div class="horarios__next-rigth">
                        <div class="next-rigth__icon">❯</div>
                    </div>
                    <input id="input-horario-selecionado" name="horario" type="hidden">
                </div>
                <hr>
                <div class="section-tela-contrate__info">
                    <div class="info__container">
                        <div class="info__container__titulo-periodo">
                            <h3>Baby born</h3>
                            <p>Periodo: 40min</p>
                        </div>
                        <div class="info__container__preco">
                            <h2>R$200</h2>
                        </div>
                    </div>
                    <hr>
                    <div class="info__funcionario">
                        <label for="funcionario">Funcionário a atender:</label>
                        <select id="funcionario" name="funcionario">
                            <option value="andre">Andre</option>
                            <option value="carla">Carla</option>
                            <option value="joao">João</option>
                            <option value="mariana">Mariana</option>
                        </select>
                    </div>
                </div>
                <hr>
                <div class="section-tela-contrate__confirmar">
                    <div class="confirmar__title-periodo">
                        <h2>Baby born</h2>
                        <p>Periodo: 40min</p>
                        <p>Total: R$200</p>
                    </div>
                    <div class="confirmar__preco-btnconfirmar">
                        <input type="submit" value="Confirmar">
                    </div>
                </div>
            </form>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Seleção de dias ---
            const diasContainer = document.querySelector('.div-wrapper__dias-disponiveis');
            const leftArrow = document.querySelector('.next-left__icon');
            const rightArrow = document.querySelector('.next-rigth__icon');
            const inputData = document.getElementById('input-data-selecionada');

            const diasPorPagina = 6;
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            let paginaAtual = 0;
            let diasGerados = [];

            function formatarIso(d) { return d.toISOString().split('T')[0]; }
            function capitalize(s) { return s.charAt(0).toUpperCase() + s.slice(1); }
            function nomeMes(d) {
                return capitalize(new Intl.DateTimeFormat('pt-BR', { month: 'short' }).format(d).replace('.', ''));
            }
            function nomeDiaSemana(d) {
                return capitalize(new Intl.DateTimeFormat('pt-BR', { weekday: 'short' }).format(d).replace('.', ''));
            }

            function gerarDias(qtd) {
                let inicioIndex = diasGerados.length;
                for (let i = inicioIndex; i < inicioIndex + qtd; i++) {
                    const d = new Date(hoje);
                    d.setDate(d.getDate() + i);
                    diasGerados.push({
                        data: d,
                        iso: formatarIso(d),
                        dia: d.getDate(),
                        mes: nomeMes(d),
                        diaSemana: nomeDiaSemana(d)
                    });
                }
            }

            function renderizarDias(pagina) {
                diasContainer.innerHTML = '';
                const inicio = pagina * diasPorPagina;
                const fim = inicio + diasPorPagina;
                const subset = diasGerados.slice(inicio, fim);

                subset.forEach(obj => {
                    const card = document.createElement('div');
                    card.classList.add('dias-disponiveis__container-dia');
                    card.dataset.iso = obj.iso;
                    card.innerHTML = `
                <div class="container-dia__status"></div>
                <p>${obj.mes}</p>
                <p>${obj.dia}</p>
                <p>${obj.diaSemana}</p>
            `;
                    diasContainer.appendChild(card);
                });

                diasContainer.appendChild(inputData); // manter input no DOM
            }

            leftArrow.addEventListener('click', () => {
                if (paginaAtual > 0) { paginaAtual--; renderizarDias(paginaAtual); }
            });
            rightArrow.addEventListener('click', () => {
                const totalPaginas = Math.ceil(diasGerados.length / diasPorPagina);
                if (paginaAtual + 1 >= totalPaginas) gerarDias(diasPorPagina);
                paginaAtual++;
                renderizarDias(paginaAtual);
            });

            gerarDias(diasPorPagina * 2);
            renderizarDias(paginaAtual);

            // --- Seleção de horários ---
            const fotografo = {
                horarios_funcionamento: {
                    Segunda: { status: true, horario: "09:00-18:00" },
                    Terça: { status: true, horario: "09:00-18:00" },
                    Quarta: { status: true, horario: "09:00-18:00" },
                    Quinta: { status: true, horario: "09:00-18:00" },
                    Sexta: { status: true, horario: "09:00-18:00" },
                    Sábado: { status: false, horario: "Fechado" },
                    Domingo: { status: false, horario: "Fechado" }
                },
                ensaios: [
                    { nome: "Baby born", duracao: 40, preco: 200 }
                ]
            };

            const duracao = fotografo.ensaios[0].duracao;
            const inputHorario = document.getElementById('input-horario-selecionado');
            const wrapperHorarios = document.querySelector('.horarios__wrapper');
            const btnManha = document.querySelector('.container-horario__manha');
            const btnTarde = document.querySelector('.container-horario__tarde');
            const btnNoite = document.querySelector('.container-horario__noite');

            function toMinutes(h) { const [hh, mm] = h.split(':').map(Number); return hh * 60 + mm; }
            function toHour(min) { const hh = String(Math.floor(min / 60)).padStart(2, '0'); const mm = String(min % 60).padStart(2, '0'); return `${hh}:${mm}`; }

            function gerarHorarios(dia, duracao) {
                const info = fotografo.horarios_funcionamento[dia];
                if (!info || !info.status || info.horario === "Fechado") return [];

                const [inicio, fim] = info.horario.split('-');
                let horaInicio = toMinutes(inicio);
                const horaFim = toMinutes(fim);
                const horarios = [];

                while (horaInicio + duracao <= horaFim) {
                    const h = toHour(horaInicio);
                    let periodo = horaInicio < 12 * 60 ? 'manha' : horaInicio < 18 * 60 ? 'tarde' : 'noite';
                    horarios.push({ hora: h, periodo });
                    horaInicio += duracao;
                }
                return horarios;
            }

            function renderizarHorarios(dia) {
                wrapperHorarios.innerHTML = '';
                const horarios = gerarHorarios(dia, duracao);
                if (horarios.length === 0) { wrapperHorarios.innerHTML = '<p>Sem horários disponíveis</p>'; return; }

                horarios.forEach(h => {
                    const div = document.createElement('div');
                    div.classList.add('wrapper__horario');
                    div.dataset.periodo = h.periodo;
                    div.innerHTML = `<p>${h.hora}</p>`;
                    wrapperHorarios.appendChild(div);
                });

                // Selecionar primeiro horário automaticamente e atualizar input
                const primeiroHorario = wrapperHorarios.querySelector('.wrapper__horario');
                if (primeiroHorario) {
                    primeiroHorario.classList.add('wrapper__horario--select');
                    inputHorario.value = primeiroHorario.textContent.trim();
                }
            }

            function ativarPeriodo(periodo) {
                btnManha.classList.remove('manha--ativo');
                btnTarde.classList.remove('tarde--ativo');
                btnNoite.classList.remove('noite--ativo');
                if (periodo === 'manha') btnManha.classList.add('manha--ativo');
                if (periodo === 'tarde') btnTarde.classList.add('tarde--ativo');
                if (periodo === 'noite') btnNoite.classList.add('noite--ativo');
            }

            btnManha.addEventListener('click', () => { ativarPeriodo('manha'); scrollParaPeriodo('manha'); });
            btnTarde.addEventListener('click', () => { ativarPeriodo('tarde'); scrollParaPeriodo('tarde'); });
            btnNoite.addEventListener('click', () => { ativarPeriodo('noite'); scrollParaPeriodo('noite'); });

            function scrollParaPeriodo(periodo) {
                const alvo = wrapperHorarios.querySelector(`.wrapper__horario[data-periodo="${periodo}"]`);

                if (alvo) {
                    // Se existe horário do período (ex: tarde), rola até ele
                    const offset = alvo.offsetLeft - wrapperHorarios.offsetLeft;
                    wrapperHorarios.scrollTo({ left: offset, behavior: 'smooth' });
                } else {
                    // Se não existe (ex: noite com poucos horários),
                    // apenas rola até o fim, sem mudar seleção
                    wrapperHorarios.scrollTo({
                        left: wrapperHorarios.scrollWidth,
                        behavior: 'smooth'
                    });
                }
            }



            // Clique em dia atualiza data e horários
            diasContainer.addEventListener('click', e => {
                const diaEl = e.target.closest('.dias-disponiveis__container-dia');
                if (!diaEl) return;

                diasContainer.querySelectorAll('.dias-disponiveis__container-dia').forEach(d => d.classList.remove('dias-disponiveis__container-dia--select'));
                diaEl.classList.add('dias-disponiveis__container-dia--select');

                const nomeDiaAbrev = diaEl.querySelector('p:last-child')?.textContent.toLowerCase().trim();
                const mapaDias = { seg: 'Segunda', ter: 'Terça', qua: 'Quarta', qui: 'Quinta', sex: 'Sexta', sab: 'Sábado', dom: 'Domingo' };
                const chave = nomeDiaAbrev.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                const diaFormatado = mapaDias[chave] || 'Segunda';

                // Atualiza input de data
                inputData.value = diaEl.dataset.iso;

                // Atualiza horários para o dia selecionado
                renderizarHorarios(diaFormatado);
            });

            // Clique em horário atualiza input
            wrapperHorarios.addEventListener('click', e => {
                const horarioEl = e.target.closest('.wrapper__horario');
                if (!horarioEl) return;
                wrapperHorarios.querySelectorAll('.wrapper__horario').forEach(h => h.classList.remove('wrapper__horario--select'));
                horarioEl.classList.add('wrapper__horario--select');
                inputHorario.value = horarioEl.textContent.trim();
            });

            // Inicial: selecionar primeiro dia e horários
            const primeiro = diasContainer.querySelector('.dias-disponiveis__container-dia');
            if (primeiro) primeiro.click();
        });

        // --- Navegação de Horários com scroll suave ---
        const leftHorarioArrow = document.querySelector('.horarios__next-left');
        const rightHorarioArrow = document.querySelector('.horarios__next-rigth');
        const wrapperHorarios = document.querySelector('.horarios__wrapper');

        // Define a distância de rolagem por clique (ajuste conforme quiser)
        const scrollStep = 200; // px

        leftHorarioArrow.addEventListener('click', () => {
            wrapperHorarios.scrollBy({ left: -scrollStep, behavior: 'smooth' });
        });

        rightHorarioArrow.addEventListener('click', () => {
            wrapperHorarios.scrollBy({ left: scrollStep, behavior: 'smooth' });
        });


        let horarioPaginaAtual = 0; // Página inicial de horários
        const horariosPorPagina = 6; // Quantos horários por vez são exibidos

        // Função para renderizar os horários
        function renderizarHorariosPagina(pagina, dia) {
            const horarios = gerarHorarios(dia, duracao);
            const inicio = pagina * horariosPorPagina;
            const fim = inicio + horariosPorPagina;
            const subset = horarios.slice(inicio, fim);

            wrapperHorarios.innerHTML = '';
            subset.forEach(h => {
                const div = document.createElement('div');
                div.classList.add('wrapper__horario');
                div.dataset.periodo = h.periodo;
                div.innerHTML = `<p>${h.hora}</p>`;
                wrapperHorarios.appendChild(div);
            });

            // Atualiza o horário selecionado automaticamente
            const primeiroHorario = wrapperHorarios.querySelector('.wrapper__horario');
            if (primeiroHorario) {
                primeiroHorario.classList.add('wrapper__horario--select');
                inputHorario.value = primeiroHorario.textContent.trim();
            }
        }

        // Navegação para a esquerda (horários)
        leftHorarioArrow.addEventListener('click', () => {
            if (horarioPaginaAtual > 0) {
                horarioPaginaAtual--;
                const diaSelecionado = diasContainer.querySelector('.dias-disponiveis__container-dia--select');
                if (diaSelecionado) {
                    const diaIso = diaSelecionado.dataset.iso;
                    const nomeDiaAbrev = new Date(diaIso).toLocaleString('pt-BR', { weekday: 'short' }).toLowerCase();
                    const mapaDias = { seg: 'Segunda', ter: 'Terça', qua: 'Quarta', qui: 'Quinta', sex: 'Sexta', sab: 'Sábado', dom: 'Domingo' };
                    const diaFormatado = mapaDias[nomeDiaAbrev] || 'Segunda';
                    renderizarHorariosPagina(horarioPaginaAtual, diaFormatado);
                }
            }
        });

        // Navegação para a direita (horários)
        rightHorarioArrow.addEventListener('click', () => {
            const diaSelecionado = diasContainer.querySelector('.dias-disponiveis__container-dia--select');
            if (diaSelecionado) {
                const diaIso = diaSelecionado.dataset.iso;
                const nomeDiaAbrev = new Date(diaIso).toLocaleString('pt-BR', { weekday: 'short' }).toLowerCase();
                const mapaDias = { seg: 'Segunda', ter: 'Terça', qua: 'Quarta', qui: 'Quinta', sex: 'Sexta', sab: 'Sábado', dom: 'Domingo' };
                const diaFormatado = mapaDias[nomeDiaAbrev] || 'Segunda';

                const horarios = gerarHorarios(diaFormatado, duracao);
                const totalHorarios = horarios.length;
                const totalPaginasHorarios = Math.ceil(totalHorarios / horariosPorPagina);

                // Verifica se podemos avançar para a próxima página
                if (horarioPaginaAtual + 1 < totalPaginasHorarios) {
                    horarioPaginaAtual++; // Avança para a próxima página
                    renderizarHorariosPagina(horarioPaginaAtual, diaFormatado); // Atualiza os horários na tela
                }
            }
        });




    </script>

</body>

</html>